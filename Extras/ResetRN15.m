function [output] = ResetRN15(Aa,flows,wts,d15N,del15NMeso,del15NMacro,del15NSalp)
%Assumed fractionation constants from the supplement of Stukel 2018 CRD
  Eps_NO3up = -5;      %Uptake of nitrate, note this was -6 in CRD
  Eps_NH4up = -10;     %Uptake of ammonia
  Eps_Nit = -14;       %Nitrification (NH4->NO3)
  Eps_ExcL = -5;       %Excretion of Mesozoo and Fish
  Eps_EgL = -1.5;      %Egestion of Mesozoo and Fish
  Eps_ExcS = -1;       %Excretion of Protistan Zoos and Salps
  Eps_EgS = -1;        %Egestion of Protistan Zoos
  Eps_ExcB = -5;       %Excretion of Bacteria
  Eps_UpB = -1;        %Bacterial uptake of DOM
  Eps_Remin = 0;       %Solubilization of Det to DOM

col0 =  39;  %The entry before the first 15N entry;
NO3_col =  1;
NH4_col =  2;
Pico_col =  3;
Dtm_col =  4;
Flag_col =  5;
HNF_col =  6;
Mic_col =  7;
Meso_col =  8;
VMMeso_col =  9;
Macro_col =  10;
VMMacro_col =  11;
Gel_col =  12;
Salp_col =  13;
Amph_col =  14;
PiscivFish_col =  15;
GelativFish_col =  16;
Myct_col =  17;
bac_col =  18;
sdet_col =  19;
mdet_col =  20;
ldet_col =  21;
SalpDet_col =  22;
Dom_col =  23;
SalpMort_col =  24;
Export_col =  25;
upNO3_col =  26;
%Withholding columns that we have 15N data for and setting the rest to a starting point;
%of 0;
RNO3 =  d15N(NO3_col);
RNH4 =  d15N(NH4_col);
RPico =  d15N(Pico_col);
RDtm =  d15N(Dtm_col);
RFlag =  d15N(Flag_col);
RHNF =  d15N(HNF_col);
RMic =  d15N(Mic_col);
%RMeso =  d15N(Meso_col);
%RVMMeso =  d15N(RVMMeso);
%RMacro =  d15N(Macro_col);
%RVMMacro =  d15N(VMMacro_col);
RGel =  d15N(Gel_col);
%RSalp =  d15N(Salp_col);
RAmph =  d15N(Amph_col);
RPiscivFish =  d15N(PiscivFish_col);
RGelativFish =  d15N(GelativFish_col);
RMyct =  d15N(Myct_col);
Rbac =  d15N(bac_col);
Rsdet =  d15N(sdet_col);
Rmdet =  d15N(mdet_col);
Rldet =  d15N(ldet_col);
RSalpDet =  d15N(SalpDet_col);
RDom =  d15N(Dom_col);
RSalpMort =  d15N(SalpMort_col);
RExport =  d15N(Export_col);
RupNO3 =  d15N(upNO3_col);
RMeso =  del15NMeso;
RVMMeso =  del15NMeso;
RMacro =  del15NMacro;
RVMMacro =  del15NMacro;
% Note the following code is necessary because no salp 15N is available for nonsalp cycles 3 and 5.;
%Ergo if we have the data, use it. If not, set it to the default.;
  if isnan(del15NSalp)
    RSalp = d15N(Salp_col);
  else
    RSalp = del15NSalp;
  end
% RN2 =  0.0036765;
% RupNO3 =  del15NupNO3/1000*RN2+RN2;
% RNO3s =  del15NNO3s/1000*RN2+RN2;
% RNH4s =  del15NNH4s/1000*RN2+RN2;
% RCyas =  del15NCyas/1000*RN2+RN2;
% RTris =  del15NTris/1000*RN2+RN2;
% RDtms =  del15NDtms/1000*RN2+RN2;
% RFlags =  del15NFlags/1000*RN2+RN2;
% RHNFs =  del15NHNFs/1000*RN2+RN2;
% RMICs =  del15NMICs/1000*RN2+RN2;
% RHerbNVMs =  del15NHerbNVMs/1000*RN2+RN2;
% RApps =  del15NApps/1000*RN2+RN2;
% RClads =  del15NClads/1000*RN2+RN2;
% RnvmCals =  del15NnvmCals/1000*RN2+RN2;
% RChaetos =  del15NChaetos/1000*RN2+RN2;
% RPoecils =  del15NPoecils/1000*RN2+RN2;
% RGelPreds =  del15NGelPreds/1000*RN2+RN2;
% RPlankfishs =  del15NPlankfishs/1000*RN2+RN2;
% RPreflexs =  del15NPreflexs/1000*RN2+RN2;
% RPostflexs =  del15NPostflexs/1000*RN2+RN2;
% RBacs =  del15NBacs/1000*RN2+RN2;
% RDets =  del15NDets/1000*RN2+RN2;
% RLdets =  del15NLdets/1000*RN2+RN2;
% RDons =  del15NDons/1000*RN2+RN2;
% RHerbVM =  del15HerbVM/1000*RN2+RN2;
% RvmCal =  del15NvmCal/1000*RN2+RN2;
%This is listing the columns for each flow in the A matrices. Copy from excel;
Upwelling	=1;
  NH4toNO3	=2;
  NH4toPico	=3;
  NH4TOdtm	=4;
  NH4TOflag	=5;
  NO3toPico	=6;
  NO3TOdtm	=7;
  NO3TOflag	=8;
  bacTOflag	=9;
  bacTOhnf	=10;
  bacTOmic	=11;
  bacTOnh4	=12;
  PicoTOhnf	=13;
  PicoTOmic	=14;
  PicoTOflag	=15;
  PicoTOSalp	=16;
  PicoTOdom	=17;
  PicoTOsdet	=18;
  dtmTOmic	=19;
  dtmTOMeso	=20;
  dtmTOVMMeso	=21;
  dtmTOMacro	=22;
  dtmTOVMMacro	=23;
  dtmTOSalp	=24;
  dtmTOdom	=25;
  dtmTOmdet	=26;
  flagTOmic	=27;
  flagTOMeso	=28;
  flagTOVMMeso	=29;
  flagTOMacro	=30;
  flagTOVMMacro	=31;
  flagTOSalp	=32;
  flagTOdom	=33;
  flagTOsdet	=34;
  hnfTOmic	=35;
  hnfTOMeso	=36;
  hnfTOVMMeso	=37;
  hnfTOMacro	=38;
  hnfTOVMMacro	=39;
  hnfTOSalp	=40;
  hnfTOnh4	=41;
  hnfTOdom	=42;
  hnfTOsdet	=43;
  micTOMeso	=44;
  micTOVMMeso	=45;
  micTOMacro	=46;
  micTOVMMacro	=47;
  micTOSalp	=48;
  micTOnh4	=49;
  micTOdom	=50;
  micTOsdet	=51;
  MesoTOMeso	=52;
  MesoTOVMMeso	=53;
  MesoTOMacro	=54;
  MesoTOVMMacro	=55;
  MesoTOgel	=56;
  MesoTOMyct	=57;
  MesoTOHTL	=58;
  MesoTOnh4	=59;
  MesoTOdom	=60;
  MesoTOmdet	=61;
  VMMesoTOMeso	=62;
  VMMesoTOVMMeso	=63;
  VMMesoTOMacro	=64;
  VMMesoTOVMMacro	=65;
  VMMesoTOgel	=66;
  VMMesoTOMyct	=67;
  VMMesoTOHTL	=68;
  VMMesoTOnh4	=69;
  VMMesoTOdom	=70;
  VMMesoTOmdet	=71;
  VMMesoTOdnh4	=72;
  VMMesoTOddom	=73;
  MacroTOgel	=74;
  MacroTOMyct	=75;
  MacroTOHTL	=76;
  MacroTOnh4	=77;
  MacroTOdom	=78;
  MacroTOldet	=79;
  VMMacroTOPiscivFish	=80;
  VMMacroTOgel	=81;
  VMMacroTOMyct	=82;
  VMMacroTOHTL	=83;
  VMMacroTOnh4	=84;
  VMMacroTOdom	=85;
  VMMacroTOldet	=86;
  VMMacroTOdnh4	=87;
  VMMacroTOddom	=88;
  gelTOAmph	=89;
  gelTOMyct	=90;
  gelTOGelativFish	=91;
  gelTOHTL	=92;
  gelTOnh4	=93;
  gelTOdom	=94;
  gelTOldet	=95;
  MyctTOPiscivFish =96;
  MyctTOnh4	=97;
  MyctTOdom	=98;
  MyctTOdnh4	=99;
  MyctTOddom	=100;
  MyctTOpoop	=101;
  MyctTObiomass	=102;
  SalpTOAmph	=103;
  SalpTOMyct	=104;
  SalpTOnh4	=105;
  SalpTOdom	=106;
  SalpTOSalpDet	=107;
  SalpTOSalpMort	=108;
  SalpTOHTL	=109;
  SalpTOdnh4	=110;
  SalpTOddom	=111;
  SalpMortTOGelativFish	=112;
  SalpMortTOSink	=113;
  AmphTOPiscivFish	=114;
  AmphTOMyct	=115;
  AmphTOHTL	=116;
  AmphTOnh4	=117;
  AmphTOdom	=118;
  AmphTOldet	=119;
  PiscivFishTOdnh4	=120;
  PiscivFishTOddom	=121;
  PiscivFishTOpoop	=122;
  PiscivFishTObiomass	=123;
  GelativFishTOdnh4	=124;
  GelativFishTOddom	=125;
  GelativFishTOpoop	=126;
  GelativFishTObiomass	=127;
  domTObac	=128;
  sdetTOhnf	=129;
  sdetTOmic	=130;
  sdetTOdom	=131;
  mdetTOmic	=132;
  mdetTOMeso	=133;
  mdetTOVMMeso	=134;
  mdetTOdom	=135;
  mdetTOSink	=136;
  ldetTOdom	=137;
  ldetTOSink	=138;
  SalpDetTOdom	=139;
  SalpDetTOSink	=140;
%Adding up the total amount consumed by each group;
HNFcons =  flows(PicoTOhnf) + flows(bacTOhnf) + flows(sdetTOhnf);
MICcons =  flows(PicoTOmic) + flows(dtmTOmic) +flows(flagTOmic) + flows(hnfTOmic) + flows(bacTOmic) + flows(sdetTOmic);
Mesocons =  flows(dtmTOMeso) + flows(flagTOMeso) + flows(hnfTOMeso) + flows(micTOMeso) + flows(MesoTOMeso) + flows(VMMesoTOMeso) + flows(mdetTOMeso);
VMMesocons =  flows(dtmTOVMMeso) + flows(flagTOVMMeso) + flows(hnfTOVMMeso) + flows(micTOVMMeso) + flows(MesoTOVMMeso) + flows(VMMesoTOVMMeso) + flows(mdetTOVMMeso);
Macrocons =  flows(dtmTOMacro) + flows(hnfTOMacro) + flows(micTOMacro) + flows(MesoTOMacro)+ flows(VMMesoTOMacro);
VMMacrocons =  flows(dtmTOVMMacro) + flows(hnfTOVMMacro) + flows(micTOVMMacro) + flows(MesoTOVMMacro) + flows(VMMesoTOVMMacro);
Gelcons =  flows(MesoTOgel)  + flows(VMMesoTOgel) + flows(MacroTOgel) + flows(VMMacroTOgel);
Salpcons =  flows(PicoTOSalp) + flows(dtmTOSalp) + flows(flagTOSalp) + flows(hnfTOSalp) + flows(micTOSalp);
Amphcons =  flows(gelTOAmph) + flows(SalpTOAmph) ;
PiscivFishcons =  flows(VMMacroTOPiscivFish) + flows(MyctTOPiscivFish) + flows(AmphTOPiscivFish);
GelativFishcons =  flows(gelTOGelativFish) + flows(SalpMortTOGelativFish) ;
Myctcons =  flows(MesoTOMyct) + flows(VMMesoTOMyct) + flows(MacroTOMyct) + flows(VMMacroTOMyct) + flows(SalpTOMyct) + flows(AmphTOMyct);
%Calculating the isotopic composition of the food of each group;
RHNFfood =  (RPico*flows(PicoTOhnf) + Rbac*flows(bacTOhnf) + Rsdet*flows(sdetTOhnf))/HNFcons;
RMICfood =  (RPico*flows(PicoTOmic) + RDtm*flows(dtmTOmic) + RFlag*flows(flagTOmic) + RHNF*flows(hnfTOmic) + Rbac*flows(bacTOmic) + Rsdet*flows(sdetTOmic))/MICcons;
RMesofood =  (RDtm*flows(dtmTOMeso) + RFlag*flows(flagTOMeso) + RHNF*flows(hnfTOMeso) + RMic*flows(micTOMeso) + RMeso*flows(MesoTOMeso) + RVMMeso*flows(VMMesoTOMeso) + Rmdet*flows(mdetTOMeso))/Mesocons;
RVMMesofood =  (RDtm*flows(dtmTOVMMeso) + RFlag*flows(flagTOVMMeso) + RHNF*flows(hnfTOVMMeso) + RMic*flows(micTOVMMeso) + RMeso*flows(MesoTOVMMeso) + RVMMeso*flows(VMMesoTOVMMeso) + Rmdet*flows(mdetTOVMMeso))/VMMesocons;
RMacrofood =  (RDtm*flows(dtmTOMacro) + RHNF*flows(hnfTOMacro) + RMic*flows(micTOMacro) + RMeso*flows(MesoTOMacro) + RVMMeso*flows(VMMesoTOMacro))/Macrocons;
RVMMacrofood =  (RDtm*flows(dtmTOVMMacro) + RHNF*flows(hnfTOVMMacro) + RMic*flows(micTOVMMacro) + ...;
RMeso*flows(MesoTOVMMacro) + RVMMeso*flows(VMMesoTOVMMacro))/VMMacrocons;
RGelfood =  (RMeso*flows(MesoTOgel) + RVMMeso*flows(VMMesoTOgel) + RMacro*flows(MacroTOgel) + RVMMacro*flows(VMMacroTOgel))/Gelcons;
RSalpfood =  (RPico*flows(PicoTOSalp) + RDtm*flows(dtmTOSalp) + RFlag*flows(flagTOSalp) + RHNF*flows(hnfTOSalp) + RMic*flows(micTOSalp))/Salpcons;
RAmphfood =  (RGel*flows(gelTOAmph) + RSalp*flows(SalpTOAmph))/Amphcons;
RPiscivFishfood =  (RVMMacro*flows(VMMacroTOPiscivFish) + RMyct*flows(MyctTOPiscivFish) + RAmph*flows(AmphTOPiscivFish))/PiscivFishcons;
RGelativFishfood =  (RGel*flows(gelTOGelativFish) + RSalp*flows(SalpMortTOGelativFish))/GelativFishcons;
RMyctfood =  (RMeso*flows(MesoTOMyct) + RVMMeso*flows(VMMesoTOMyct) + RMacro*flows(MacroTOMyct) + RVMMacro*flows(VMMacroTOMyct) + RSalp*flows(SalpTOMyct) + RAmph*flows(AmphTOMyct))/Myctcons;
%Computing the sum of each flow for normalization purposes;
totflowNO3 =  sum(flows([Upwelling,NH4toNO3]));
totflowNH4 =  sum(flows([bacTOnh4,hnfTOnh4,micTOnh4,MesoTOnh4,VMMesoTOnh4,MacroTOnh4,VMMacroTOnh4,gelTOnh4,MyctTOnh4,SalpTOnh4,AmphTOnh4]));
totflowPico =  sum(flows([NH4toPico,NO3toPico]));
totflowDtm =  sum(flows([NH4TOdtm,NO3TOdtm]));
totflowFlag =  sum(flows([NH4TOflag,NO3TOflag,bacTOflag,PicoTOflag]));
totflowHNF =  sum(flows([bacTOhnf,PicoTOhnf,sdetTOhnf]));
totflowMic =  sum(flows([bacTOmic,PicoTOmic,dtmTOmic,flagTOmic,hnfTOmic,sdetTOmic]));
totflowMeso =  sum(flows([dtmTOMeso,flagTOMeso,hnfTOMeso,MesoTOMeso,VMMesoTOMeso,mdetTOMeso]));
totflowVMMeso =  sum(flows([dtmTOVMMeso,flagTOVMMeso,hnfTOVMMeso,MesoTOVMMeso,VMMesoTOVMMeso,mdetTOVMMeso]));
totflowMacro =  sum(flows([dtmTOMacro,flagTOMacro,hnfTOMacro,micTOMacro,MesoTOMacro,VMMesoTOMacro]));
totflowVMMacro =  sum(flows([dtmTOVMMacro,flagTOVMMacro,hnfTOVMMacro,micTOVMMacro,MesoTOVMMacro,VMMesoTOVMMacro]));
totflowGel =  sum(flows([MesoTOgel,VMMesoTOgel,MacroTOgel,VMMacroTOgel]));
totflowSalp =  sum(flows([PicoTOSalp,dtmTOSalp,flagTOSalp,hnfTOSalp,micTOSalp]));
totflowAmph =  sum(flows([gelTOAmph,SalpTOAmph]));
totflowPiscivFish =  sum(flows([VMMacroTOPiscivFish,MyctTOPiscivFish,AmphTOPiscivFish]));
totflowGelativFish =  sum(flows([gelTOGelativFish,SalpMortTOGelativFish]));
totflowMyct =  sum(flows([MesoTOMyct,VMMesoTOMyct,MacroTOMyct,VMMacroTOMyct,SalpTOMyct,AmphTOMyct]));
totflowBac =  sum(flows([domTObac]));
totflowSdet =  sum(flows([PicoTOsdet,flagTOsdet,hnfTOsdet,micTOsdet]));
totflowMdet =  sum(flows([dtmTOmdet,MesoTOmdet,VMMesoTOmdet]));
totflowLdet =  sum(flows([MacroTOldet,VMMacroTOldet,gelTOldet,AmphTOldet]));
totflowSalpDet =  sum(flows([SalpTOSalpDet]));
totflowDOM =  sum(flows([PicoTOdom,dtmTOdom,flagTOdom,hnfTOdom,micTOdom,MesoTOdom,VMMesoTOdom,MacroTOdom,VMMacroTOdom,gelTOdom,MyctTOdom,SalpTOdom,AmphTOdom,sdetTOdom,mdetTOdom,ldetTOdom,SalpDetTOdom]));
totflowSalpMort =  sum(flows([SalpTOSalpMort]));
totflowExport =  sum(flows([MesoTOHTL,VMMesoTOHTL,VMMesoTOdnh4,VMMesoTOddom,MacroTOHTL,VMMacroTOHTL,VMMacroTOdnh4,VMMacroTOddom,gelTOHTL,MyctTOdnh4,MyctTOddom,MyctTOpoop,MyctTObiomass,SalpTOHTL,SalpTOdnh4,SalpTOddom,SalpMortTOSink,AmphTOHTL,PiscivFishTOdnh4,PiscivFishTOddom,PiscivFishTOpoop,PiscivFishTObiomass,GelativFishTOdnh4,GelativFishTOddom,GelativFishTOpoop,GelativFishTObiomass,mdetTOSink,ldetTOSink,SalpDetTOSink]));
%This codifies every entry in the d15N portion of the excel matrix from top left;
%to bottom right, column by column;
Aa(col0+NO3_col,Upwelling) =  RupNO3;
Aa(col0+NO3_col,NH4toNO3) =  RNH4+Eps_Nit;
Aa(col0+NO3_col,NO3toPico) =  -(RNO3+Eps_NO3up);
Aa(col0+NO3_col,NO3TOdtm) =  -(RNO3+Eps_NO3up);
Aa(col0+NO3_col,NO3TOflag) =  -(RNO3+Eps_NO3up);
Aa(col0+NH4_col,NH4toNO3) =  -(RNH4+Eps_Nit);
Aa(col0+NH4_col,NH4toPico) =  -(RNH4+Eps_NH4up);
Aa(col0+NH4_col,NH4TOdtm) =  -(RNH4+Eps_NH4up);
Aa(col0+NH4_col,NH4TOflag) =  -(RNH4+Eps_NH4up);
Aa(col0+NH4_col,bacTOnh4) =  Rbac+Eps_ExcB;
Aa(col0+NH4_col,hnfTOnh4) =  RHNF+Eps_ExcS;
Aa(col0+NH4_col,micTOnh4) =  RMic+Eps_ExcS;
Aa(col0+NH4_col,MesoTOnh4) =  RMeso+Eps_ExcL;
Aa(col0+NH4_col,VMMesoTOnh4) =  RVMMeso+Eps_ExcL;
Aa(col0+NH4_col,MacroTOnh4) =  RMacro+Eps_ExcL;
Aa(col0+NH4_col,VMMacroTOnh4) =  RVMMacro+Eps_ExcL;
Aa(col0+NH4_col,gelTOnh4) =  RGel+Eps_ExcL;
Aa(col0+NH4_col,MyctTOnh4) =  RMyct+Eps_ExcL;
Aa(col0+NH4_col,SalpTOnh4) =  RSalp+Eps_ExcS;
Aa(col0+NH4_col,AmphTOnh4) =  RAmph+Eps_ExcL;
Aa(col0+Pico_col,NH4toPico) =  RNH4+Eps_NH4up;
Aa(col0+Pico_col,NO3toPico) =  RNO3+Eps_NO3up;
Aa(col0+Pico_col,PicoTOhnf) =  -RPico;
Aa(col0+Pico_col,PicoTOmic) =  -RPico;
Aa(col0+Pico_col,PicoTOflag) =  -RPico;
Aa(col0+Pico_col,PicoTOSalp) =  -RPico;
Aa(col0+Pico_col,PicoTOdom) =  -RPico;
Aa(col0+Pico_col,PicoTOsdet) =  -RPico;
Aa(col0+Dtm_col,NH4TOdtm) =  RNH4+Eps_NH4up;
Aa(col0+Dtm_col,NO3TOdtm) =  RNO3+Eps_NO3up;
Aa(col0+Dtm_col,dtmTOmic) =  -RDtm;
Aa(col0+Dtm_col,dtmTOMeso) =  -RDtm;
Aa(col0+Dtm_col,dtmTOVMMeso) =  -RDtm;
Aa(col0+Dtm_col,dtmTOMacro) =  -RDtm;
Aa(col0+Dtm_col,dtmTOVMMacro) =  -RDtm;
Aa(col0+Dtm_col,dtmTOSalp) =  -RDtm;
Aa(col0+Dtm_col,dtmTOdom) =  -RDtm;
Aa(col0+Dtm_col,dtmTOmdet) =  -RDtm;
Aa(col0+Flag_col,NH4TOflag) =  RNH4+Eps_NH4up;
Aa(col0+Flag_col,NO3TOflag) =  RNO3+Eps_NO3up;
Aa(col0+Flag_col,bacTOflag) =  Rbac;
Aa(col0+Flag_col,PicoTOflag) =  RPico;
Aa(col0+Flag_col,flagTOmic) =  -RFlag;
Aa(col0+Flag_col,flagTOMeso) =  -RFlag;
Aa(col0+Flag_col,flagTOVMMeso) =  -RFlag;
Aa(col0+Flag_col,flagTOMacro) =  -RFlag;
Aa(col0+Flag_col,flagTOVMMacro) =  -RFlag;
Aa(col0+Flag_col,flagTOSalp) =  -RFlag;
Aa(col0+Flag_col,flagTOdom) =  -RFlag;
Aa(col0+Flag_col,flagTOsdet) =  -RFlag;
Aa(col0+HNF_col,bacTOhnf) =  Rbac;
Aa(col0+HNF_col,PicoTOhnf) =  RPico;
Aa(col0+HNF_col,hnfTOmic) =  -RHNF;
Aa(col0+HNF_col,hnfTOMeso) =  -RHNF;
Aa(col0+HNF_col,hnfTOVMMeso) =  -RHNF;
Aa(col0+HNF_col,hnfTOMacro) =  -RHNF;
Aa(col0+HNF_col,hnfTOVMMacro) =  -RHNF;
Aa(col0+HNF_col,hnfTOSalp) =  -RHNF;
Aa(col0+HNF_col,hnfTOnh4) =  -(RHNF+Eps_ExcS);
Aa(col0+HNF_col,hnfTOdom) =  -(RHNF+Eps_ExcS);
Aa(col0+HNF_col,hnfTOsdet) =  -(RHNFfood+Eps_EgS);
Aa(col0+HNF_col,sdetTOhnf) =  Rsdet;
Aa(col0+Mic_col,bacTOmic) =   Rbac;
Aa(col0+Mic_col,PicoTOmic) =  RPico;
Aa(col0+Mic_col,dtmTOmic) =  RDtm;
Aa(col0+Mic_col,flagTOmic) =  RFlag;
Aa(col0+Mic_col,hnfTOmic) =  RHNF;
Aa(col0+Mic_col,micTOMeso) =  -RMic;
Aa(col0+Mic_col,micTOVMMeso) =  -RMic;
Aa(col0+Mic_col,micTOMacro) =  -RMic;
Aa(col0+Mic_col,micTOVMMacro) =  -RMic;
Aa(col0+Mic_col,micTOSalp) =  -RMic;
Aa(col0+Mic_col,micTOnh4) =  -(RMic+Eps_ExcS);
Aa(col0+Mic_col,micTOdom) =  -(RMic+Eps_ExcS);
Aa(col0+Mic_col,micTOsdet) =  -(RMICfood+Eps_EgS);
Aa(col0+Mic_col,sdetTOmic) =   Rsdet;
Aa(col0+Mic_col,mdetTOmic) =   Rmdet;
Aa(col0+Meso_col,dtmTOMeso) =  RDtm;
Aa(col0+Meso_col,flagTOMeso) =  RFlag;
Aa(col0+Meso_col,hnfTOMeso) =  RHNF;
Aa(col0+Meso_col,micTOMeso) =  RMic;
Aa(col0+Meso_col,MesoTOVMMeso) = -RMeso;
Aa(col0+Meso_col,MesoTOMacro) =  -RMeso;
Aa(col0+Meso_col,MesoTOVMMacro) =  -RMeso;
Aa(col0+Meso_col,MesoTOgel) =  -RMeso;
Aa(col0+Meso_col,MesoTOMyct) =  -RMeso;
Aa(col0+Meso_col,MesoTOHTL) =  -RMeso;
Aa(col0+Meso_col,MesoTOnh4) =  -(RMeso+Eps_ExcL);
Aa(col0+Meso_col,MesoTOdom) =  -(RMeso+Eps_ExcL);
Aa(col0+Meso_col,MesoTOmdet) =  -(RMesofood+Eps_EgL);
Aa(col0+Meso_col,VMMesoTOMeso) =  RVMMeso;
Aa(col0+Meso_col,mdetTOMeso) =  Rmdet;
Aa(col0+VMMeso_col,dtmTOVMMeso) =  RDtm;
Aa(col0+VMMeso_col,flagTOVMMeso) =  RFlag;
Aa(col0+VMMeso_col,hnfTOVMMeso) =  RHNF;
Aa(col0+VMMeso_col,micTOVMMeso) =  RMic;
Aa(col0+VMMeso_col,MesoTOVMMeso) = RMeso;
Aa(col0+VMMeso_col,VMMesoTOMeso) = -RVMMeso;
Aa(col0+VMMeso_col,VMMesoTOMacro) =  -RVMMeso;
Aa(col0+VMMeso_col,VMMesoTOVMMacro) =  -RVMMeso;
Aa(col0+VMMeso_col,VMMesoTOgel) =  -RVMMeso;
Aa(col0+VMMeso_col,VMMesoTOMyct) =  -RVMMeso;
Aa(col0+VMMeso_col,VMMesoTOHTL) =  -RVMMeso;
Aa(col0+VMMeso_col,VMMesoTOnh4) =  -(RVMMeso+Eps_ExcL);
Aa(col0+VMMeso_col,VMMesoTOdom) =  -(RVMMeso+Eps_ExcL);
Aa(col0+VMMeso_col,VMMesoTOmdet) =  -(RVMMesofood+Eps_EgL);
Aa(col0+VMMeso_col,VMMesoTOdnh4) =  -(RVMMeso+Eps_ExcL);
Aa(col0+VMMeso_col,VMMesoTOddom) =  -(RVMMeso+Eps_ExcL);
Aa(col0+VMMeso_col,mdetTOVMMeso) =  Rmdet;
Aa(col0+Macro_col,dtmTOMacro) =  RDtm;
Aa(col0+Macro_col,flagTOMacro) =  RFlag;
Aa(col0+Macro_col,hnfTOMacro) =  RHNF;
Aa(col0+Macro_col,micTOMacro) =  RMic;
Aa(col0+Macro_col,MesoTOMacro) =  RMeso;
Aa(col0+Macro_col,VMMesoTOMacro) =  RVMMeso;
Aa(col0+Macro_col,MacroTOgel) =  -RMacro;
Aa(col0+Macro_col,MacroTOMyct) =  -RMacro;
Aa(col0+Macro_col,MacroTOHTL) =  -RMacro;
Aa(col0+Macro_col,MacroTOnh4) =  -(RMacro+Eps_ExcL);
Aa(col0+Macro_col,MacroTOdom) =  -(RMacro+Eps_ExcL);
Aa(col0+Macro_col,MacroTOldet) =  -(RMacrofood+Eps_EgL);
Aa(col0+VMMacro_col,dtmTOVMMacro) =  RDtm;
Aa(col0+VMMacro_col,flagTOVMMacro) =  RFlag;
Aa(col0+VMMacro_col,hnfTOVMMacro) =  RHNF;
Aa(col0+VMMacro_col,micTOVMMacro) =  RMic;
Aa(col0+VMMacro_col,MesoTOVMMacro) =  RMeso;
Aa(col0+VMMacro_col,VMMesoTOVMMacro) =  RVMMeso;
Aa(col0+VMMacro_col,VMMacroTOPiscivFish) =  -RVMMacro;
Aa(col0+VMMacro_col,VMMacroTOgel) =  -RVMMacro;
Aa(col0+VMMacro_col,VMMacroTOMyct) =  -RVMMacro;
Aa(col0+VMMacro_col,VMMacroTOHTL) =  -RVMMacro;
Aa(col0+VMMacro_col,VMMacroTOnh4) =  -(RVMMacro+Eps_ExcL);
Aa(col0+VMMacro_col,VMMacroTOdom) =  -(RVMMacro+Eps_ExcL);
Aa(col0+VMMacro_col,VMMacroTOldet) =  -(RVMMacrofood+Eps_EgL);
Aa(col0+VMMacro_col,VMMacroTOdnh4) =  -(RVMMacro+Eps_ExcL);
Aa(col0+VMMacro_col,VMMacroTOddom) =  -(RVMMacro+Eps_ExcL);
Aa(col0+Gel_col,MesoTOgel) =  RMeso;
Aa(col0+Gel_col,VMMesoTOgel) =  RVMMeso;
Aa(col0+Gel_col,MacroTOgel) =  RMacro;
Aa(col0+Gel_col,VMMacroTOgel) =  RVMMacro;
Aa(col0+Gel_col,gelTOAmph) =  -RGel;
Aa(col0+Gel_col,gelTOMyct) =  -RGel;
Aa(col0+Gel_col,gelTOGelativFish) =  -RGel;
Aa(col0+Gel_col,gelTOHTL) =  -RGel;
Aa(col0+Gel_col,gelTOnh4) =  -(RGel+Eps_ExcL);
Aa(col0+Gel_col,gelTOdom) =  -(RGel+Eps_ExcL);
Aa(col0+Gel_col,gelTOldet) =  -(RGelfood+Eps_EgL);
Aa(col0+Salp_col,PicoTOSalp) =  RPico;
Aa(col0+Salp_col,dtmTOSalp) =  RDtm;
Aa(col0+Salp_col,flagTOSalp) =  RFlag;
Aa(col0+Salp_col,hnfTOSalp) =  RHNF;
Aa(col0+Salp_col,micTOSalp) =  RMic;
Aa(col0+Salp_col,SalpTOAmph) =  -RSalp;
Aa(col0+Salp_col,SalpTOMyct) =  -RSalp;
Aa(col0+Salp_col,SalpTOnh4) =  -(RSalp+Eps_ExcS);
Aa(col0+Salp_col,SalpTOdom) =  -(RSalp+Eps_ExcS);
Aa(col0+Salp_col,SalpTOSalpDet) =  -(RSalpfood+Eps_EgS);
Aa(col0+Salp_col,SalpTOSalpMort) =  -RSalp;
Aa(col0+Salp_col,SalpTOHTL) =  -RSalp;
Aa(col0+Salp_col,SalpTOdnh4) =  -(RSalp+Eps_ExcS);
Aa(col0+Salp_col,SalpTOddom) =  -(RSalp+Eps_ExcS);
Aa(col0+Amph_col,gelTOAmph) =  RGel;
Aa(col0+Amph_col,SalpTOAmph) =  RSalp;
Aa(col0+Amph_col,AmphTOPiscivFish) =  -RAmph;
Aa(col0+Amph_col,AmphTOMyct) =  -RAmph;
Aa(col0+Amph_col,AmphTOHTL) =  -RAmph;
Aa(col0+Amph_col,AmphTOnh4) =  -(RAmph+Eps_ExcL);
Aa(col0+Amph_col,AmphTOdom) =  -(RAmph+Eps_ExcL);
Aa(col0+Amph_col,AmphTOldet) =  -(RAmphfood+Eps_EgL);
Aa(col0+PiscivFish_col,VMMacroTOPiscivFish) =  RVMMacro;
Aa(col0+PiscivFish_col,MyctTOPiscivFish) =  RMyct;
Aa(col0+PiscivFish_col,AmphTOPiscivFish) =  RAmph;
Aa(col0+PiscivFish_col,PiscivFishTOdnh4) =  -(RPiscivFish+Eps_ExcL);
Aa(col0+PiscivFish_col,PiscivFishTOddom) =  -(RPiscivFish+Eps_ExcL);
Aa(col0+PiscivFish_col,PiscivFishTOpoop) =  -(RPiscivFishfood+Eps_EgL);
Aa(col0+PiscivFish_col,PiscivFishTObiomass) =  -RPiscivFish;
Aa(col0+GelativFish_col,gelTOGelativFish) =  RGel;
Aa(col0+GelativFish_col,SalpMortTOGelativFish) =  RSalp;
Aa(col0+GelativFish_col,GelativFishTOdnh4) =  -(RGelativFish+Eps_ExcL);
Aa(col0+GelativFish_col,GelativFishTOddom) =  -(RGelativFish+Eps_ExcL);
Aa(col0+GelativFish_col,GelativFishTOpoop) =  -(RGelativFishfood+Eps_EgL);
Aa(col0+GelativFish_col,GelativFishTObiomass) =  -RGelativFish;
Aa(col0+Myct_col,MesoTOMyct) =  RMeso;
Aa(col0+Myct_col,VMMesoTOMyct) =  RVMMeso;
Aa(col0+Myct_col,MacroTOMyct) =  RMacro;
Aa(col0+Myct_col,VMMacroTOMyct) =  RVMMacro;
Aa(col0+Myct_col,gelTOMyct) =  RGel;
Aa(col0+Myct_col,MyctTOPiscivFish) =  -RMyct;
Aa(col0+Myct_col,MyctTOnh4) =  -(RMyct+Eps_ExcL);
Aa(col0+Myct_col,MyctTOdom) =  -(RMyct+Eps_ExcL);
Aa(col0+Myct_col,MyctTOdnh4) =  -(RMyct+Eps_ExcL);
Aa(col0+Myct_col,MyctTOddom) =  -(RMyct+Eps_ExcL);
Aa(col0+Myct_col,MyctTOpoop) =  -(RMyctfood+Eps_EgL);
Aa(col0+Myct_col,MyctTObiomass) =  -RMyct;
Aa(col0+Myct_col,SalpTOMyct) =  RSalp;
Aa(col0+Myct_col,AmphTOMyct) =  RAmph;
Aa(col0+bac_col,bacTOflag) =  -Rbac;
Aa(col0+bac_col,bacTOhnf) =  -Rbac;
Aa(col0+bac_col,bacTOmic) =  -Rbac;
Aa(col0+bac_col,bacTOnh4) =  -(Rbac+Eps_ExcB);
Aa(col0+bac_col,domTObac) =  RDom+Eps_UpB;
Aa(col0+sdet_col,PicoTOsdet) =  RPico;
Aa(col0+sdet_col,flagTOsdet) =  RFlag;
Aa(col0+sdet_col,hnfTOsdet) =  (RHNFfood+Eps_EgS);
Aa(col0+sdet_col,micTOsdet) =  (RMICfood+Eps_EgS);
Aa(col0+sdet_col,sdetTOhnf) =  -Rsdet;
Aa(col0+sdet_col,sdetTOmic) =  -Rsdet;
Aa(col0+sdet_col,sdetTOdom) =  -(Rsdet+Eps_Remin);
Aa(col0+mdet_col,dtmTOmdet) =  RDtm;
Aa(col0+mdet_col,MesoTOmdet) =  (RMesofood+Eps_EgL);
Aa(col0+mdet_col,VMMesoTOmdet) =  (RVMMesofood+Eps_EgL);
Aa(col0+mdet_col,mdetTOmic) =  -Rmdet;
Aa(col0+mdet_col,mdetTOMeso) =  -Rmdet;
Aa(col0+mdet_col,mdetTOVMMeso) =  -Rmdet;
Aa(col0+mdet_col,mdetTOdom) =  -(Rmdet+Eps_Remin);
Aa(col0+mdet_col,mdetTOSink) =  -Rmdet;
Aa(col0+ldet_col,MacroTOldet) =  (RMacrofood+Eps_EgL);
Aa(col0+ldet_col,VMMacroTOldet) =  (RVMMacrofood+Eps_EgL);
Aa(col0+ldet_col,gelTOldet) =  (RGelfood+Eps_EgL);
Aa(col0+ldet_col,AmphTOldet) =  (RAmphfood+Eps_EgL);
Aa(col0+ldet_col,ldetTOdom) =  -(Rldet+Eps_Remin);
Aa(col0+ldet_col,ldetTOSink) =  -Rldet;
Aa(col0+SalpDet_col,SalpTOSalpDet) =  (RSalpfood+Eps_EgS);
Aa(col0+SalpDet_col,SalpDetTOdom) =  -(RSalpDet+Eps_Remin);
Aa(col0+SalpDet_col,SalpDetTOSink) =  -RSalpDet;
Aa(col0+Dom_col,PicoTOdom) =  RPico;
Aa(col0+Dom_col,dtmTOdom) =  RDtm;
Aa(col0+Dom_col,flagTOdom) =  RFlag;
Aa(col0+Dom_col,hnfTOdom) =  (RHNF+Eps_ExcS);
Aa(col0+Dom_col,micTOdom) =  (RMic+Eps_ExcS);
Aa(col0+Dom_col,MesoTOdom) =  (RMeso+Eps_ExcL);
Aa(col0+Dom_col,VMMesoTOdom) =  (RVMMeso+Eps_ExcL);
Aa(col0+Dom_col,MacroTOdom) =  (RMacro+Eps_ExcL);
Aa(col0+Dom_col,VMMacroTOdom) =  (RVMMacro+Eps_ExcL);
Aa(col0+Dom_col,gelTOdom) =  (RGel+Eps_ExcL);
Aa(col0+Dom_col,MyctTOdom) =  (RMyct+Eps_ExcL);
Aa(col0+Dom_col,SalpTOdom) =  (RSalp+Eps_ExcS);
Aa(col0+Dom_col,AmphTOdom) =  (RAmph+Eps_ExcL);
Aa(col0+Dom_col,domTObac) =  -(RDom+Eps_UpB);
Aa(col0+Dom_col,sdetTOdom) =  (Rsdet+Eps_Remin);
Aa(col0+Dom_col,mdetTOdom) =  (Rmdet+Eps_Remin);
Aa(col0+Dom_col,ldetTOdom) =  (Rldet+Eps_Remin);
Aa(col0+Dom_col,SalpDetTOdom) =  (RSalpDet+Eps_Remin);
Aa(col0+SalpMort_col,SalpTOSalpMort) =  RSalp;
Aa(col0+SalpMort_col,SalpMortTOGelativFish) =  -RSalp;
Aa(col0+SalpMort_col,SalpMortTOSink) =  -RSalp;
Aa(col0+Export_col,MesoTOHTL) = RMeso;
Aa(col0+Export_col,VMMesoTOHTL) = RVMMeso;
Aa(col0+Export_col,VMMesoTOdnh4) = (RVMMeso+Eps_ExcL);
Aa(col0+Export_col,VMMesoTOddom) = (RVMMeso+Eps_ExcL);
Aa(col0+Export_col,MacroTOHTL) = RMacro;
Aa(col0+Export_col,VMMacroTOHTL) = RVMMacro;
Aa(col0+Export_col,VMMacroTOdnh4) = (RVMMacro+Eps_ExcL);
Aa(col0+Export_col,VMMacroTOddom) = (RVMMacro+Eps_ExcL);
Aa(col0+Export_col,gelTOHTL) = RGel;
Aa(col0+Export_col,MyctTOdnh4) = (RMyct+Eps_ExcL);
Aa(col0+Export_col,MyctTOddom) = (RMyct+Eps_ExcL);
Aa(col0+Export_col,MyctTOpoop) = (RMyctfood+Eps_EgL);
Aa(col0+Export_col,MyctTObiomass) = RMyct;
Aa(col0+Export_col,SalpTOHTL) = RSalp;
Aa(col0+Export_col,SalpTOdnh4) = (RSalp+Eps_ExcS);
Aa(col0+Export_col,SalpTOddom) = (RSalp+Eps_ExcS);
Aa(col0+Export_col,SalpMortTOSink) = RSalp;
Aa(col0+Export_col,AmphTOHTL) = RAmph;
Aa(col0+Export_col,PiscivFishTOdnh4) = (RPiscivFish+Eps_ExcL);
Aa(col0+Export_col,PiscivFishTOddom) = (RPiscivFish+Eps_ExcL);
Aa(col0+Export_col,PiscivFishTOpoop) = (RPiscivFishfood+Eps_EgL);
Aa(col0+Export_col,PiscivFishTObiomass) = RPiscivFish;
Aa(col0+Export_col,GelativFishTOdnh4) = (RGelativFish+Eps_ExcL);
Aa(col0+Export_col,GelativFishTOddom) = (RGelativFish+Eps_ExcL);
Aa(col0+Export_col,GelativFishTOpoop) = (RGelativFishfood+Eps_EgL);
Aa(col0+Export_col,GelativFishTObiomass) = RGelativFish;
Aa(col0+Export_col,mdetTOSink) = Rmdet;
Aa(col0+Export_col,ldetTOSink) = Rldet;
Aa(col0+Export_col,SalpDetTOSink) = RSalpDet;

Aa(col0+NO3_col,:) =  Aa(col0+NO3_col,:)/totflowNO3;
Aa(col0+NH4_col,:) =  Aa(col0+NH4_col,:)/totflowNH4;
Aa(col0+Pico_col,:) =  Aa(col0+Pico_col,:)/totflowPico;
Aa(col0+Dtm_col,:) =  Aa(col0+Dtm_col,:)/totflowDtm;
Aa(col0+Flag_col,:) =  Aa(col0+Flag_col,:)/totflowFlag;
Aa(col0+HNF_col,:) =  Aa(col0+HNF_col,:)/totflowHNF;
Aa(col0+Mic_col,:) =  Aa(col0+Mic_col,:)/totflowMic;
Aa(col0+Meso_col,:) =  Aa(col0+Meso_col,:)/totflowMeso;
Aa(col0+VMMeso_col,:) =  Aa(col0+VMMeso_col,:)/totflowVMMeso;
Aa(col0+Macro_col,:) =  Aa(col0+Macro_col,:)/totflowMacro;
Aa(col0+VMMacro_col,:) =  Aa(col0+VMMacro_col,:)/totflowVMMacro;
Aa(col0+Gel_col,:) =  Aa(col0+Gel_col,:)/totflowGel;
Aa(col0+Salp_col,:) =  Aa(col0+Salp_col,:)/totflowSalp;
Aa(col0+SalpMort_col,:) =  Aa(col0+SalpMort_col,:)/totflowSalpMort;
Aa(col0+Amph_col,:) =  Aa(col0+Amph_col,:)/totflowAmph;
Aa(col0+PiscivFish_col,:) =  Aa(col0+PiscivFish_col,:)/totflowPiscivFish;
Aa(col0+GelativFish_col,:) =  Aa(col0+GelativFish_col,:)/totflowGelativFish;
Aa(col0+Myct_col,:) =  Aa(col0+Myct_col,:)/totflowMyct;
Aa(col0+bac_col,:) =  Aa(col0+bac_col,:)/totflowBac;
Aa(col0+sdet_col,:) =  Aa(col0+sdet_col,:)/totflowSdet;
Aa(col0+mdet_col,:) =  Aa(col0+mdet_col,:)/totflowMdet;
Aa(col0+ldet_col,:) =  Aa(col0+ldet_col,:)/totflowLdet;
Aa(col0+SalpDet_col,:) =  Aa(col0+SalpDet_col,:)/totflowSalpDet;
Aa(col0+Dom_col,:) =  Aa(col0+Dom_col,:)/totflowDOM;
Aa(col0+Export_col,:) =  Aa(col0+Export_col,:)/totflowExport;
for i=1:length(wts)
    Aa(:,i)=Aa(:,i)/wts(i);
end

output=Aa;
